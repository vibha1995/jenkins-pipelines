pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                git 'https://github.com/hshar/website.git'
            }
        }

        stage('Build and Test') {
            when {
                anyOf {
                    branch 'master'
                    branch 'develop'
                }
            }
            steps {
                script {
                    def branchName = env.BRANCH_NAME
                    def testOnly = branchName == 'develop'
                    def publish = !testOnly

                    // Build the website-builder image
                    sh 'docker build -t test .'

                    // Run tests
                    sh "echo 'This is a blank test. It always succeeds.'"

                    // If 'publish' is true, push to prod
                    if (publish) {
                        // Push to prod (replace with your deployment logic)
                        sh 'docker run -itd -p 82:80 --name=masterserver website-builder'
                    }
                }
            }
        }
    }
}

